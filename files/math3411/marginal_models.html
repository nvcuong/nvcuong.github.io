<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Marginal models | Advanced Statistical Modelling III (second term)</title>
  <meta name="description" content="These are the course notes for the module Advanced Statistical Modelling III of Durham University’s degree for Mathematics and Statistics." />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Marginal models | Advanced Statistical Modelling III (second term)" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="These are the course notes for the module Advanced Statistical Modelling III of Durham University’s degree for Mathematics and Statistics." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Marginal models | Advanced Statistical Modelling III (second term)" />
  
  <meta name="twitter:description" content="These are the course notes for the module Advanced Statistical Modelling III of Durham University’s degree for Mathematics and Statistics." />
  

<meta name="author" content="Department of Mathematical Sciences at Durham University" />


<meta name="date" content="2024-03-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="quasi_likelihood.html"/>
<link rel="next" href="linear_mixed_models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Statistical Modelling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>General Information</a></li>
<li class="chapter" data-level="1" data-path="generalised_linear_models.html"><a href="generalised_linear_models.html"><i class="fa fa-check"></i><b>1</b> Review of Generalised Linear Models</a></li>
<li class="chapter" data-level="2" data-path="estimation.html"><a href="estimation.html"><i class="fa fa-check"></i><b>2</b> Estimation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="estimation.html"><a href="estimation.html#likelihood"><i class="fa fa-check"></i><b>2.1</b> Likelihood</a></li>
<li class="chapter" data-level="2.2" data-path="estimation.html"><a href="estimation.html#loglike"><i class="fa fa-check"></i><b>2.2</b> Log-Likelihood</a></li>
<li class="chapter" data-level="2.3" data-path="estimation.html"><a href="estimation.html#score-function-and-equation"><i class="fa fa-check"></i><b>2.3</b> Score Function and Equation</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="estimation.html"><a href="estimation.html#natural-link"><i class="fa fa-check"></i><b>2.3.1</b> Natural Link</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="estimation.html"><a href="estimation.html#fisherinformation"><i class="fa fa-check"></i><b>2.4</b> Fisher Information</a></li>
<li class="chapter" data-level="2.5" data-path="estimation.html"><a href="estimation.html#example-poisson-regression"><i class="fa fa-check"></i><b>2.5</b> Example: Poisson Regression</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="estimation.html"><a href="estimation.html#with-natural-link"><i class="fa fa-check"></i><b>2.5.1</b> With Natural Link</a></li>
<li class="chapter" data-level="2.5.2" data-path="estimation.html"><a href="estimation.html#with-identity-link"><i class="fa fa-check"></i><b>2.5.2</b> With Identity Link</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="estimation.html"><a href="estimation.html#properties-of-boldsymbolsboldsymbolbeta-and-boldsymbolfboldsymbolbeta"><i class="fa fa-check"></i><b>2.6</b> Properties of <span class="math inline">\(\boldsymbol{S}(\boldsymbol{\beta})\)</span> and <span class="math inline">\(\boldsymbol{F}(\boldsymbol{\beta})\)</span></a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="estimation.html"><a href="estimation.html#expectation-of-boldsymbolsboldsymbolbeta"><i class="fa fa-check"></i><b>2.6.1</b> Expectation of <span class="math inline">\(\boldsymbol{S}(\boldsymbol{\beta})\)</span></a></li>
<li class="chapter" data-level="2.6.2" data-path="estimation.html"><a href="estimation.html#variance-of-boldsymbolsboldsymbolbeta"><i class="fa fa-check"></i><b>2.6.2</b> Variance of <span class="math inline">\(\boldsymbol{S}(\boldsymbol{\beta})\)</span></a></li>
<li class="chapter" data-level="2.6.3" data-path="estimation.html"><a href="estimation.html#boldsymbolfboldsymbolbeta"><i class="fa fa-check"></i><b>2.6.3</b> <span class="math inline">\(\boldsymbol{F}(\boldsymbol{\beta})\)</span></a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="estimation.html"><a href="estimation.html#matrix-notation"><i class="fa fa-check"></i><b>2.7</b> Matrix Notation</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="estimation.html"><a href="estimation.html#matrixform"><i class="fa fa-check"></i><b>2.7.1</b> Score Function and Fisher Information</a></li>
<li class="chapter" data-level="2.7.2" data-path="estimation.html"><a href="estimation.html#natural-link-2"><i class="fa fa-check"></i><b>2.7.2</b> Natural Link</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="estimation.html"><a href="estimation.html#iterativesolution"><i class="fa fa-check"></i><b>2.8</b> Iterative Solution of <span class="math inline">\(\boldsymbol{S}(\hat{\boldsymbol{\beta}}) = 0\)</span></a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="estimation.html"><a href="estimation.html#irls-pseudo-code"><i class="fa fa-check"></i><b>2.8.1</b> IRLS Pseudo-Code</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="estimation.html"><a href="estimation.html#practical-example-us-polio-data"><i class="fa fa-check"></i><b>2.9</b> Practical Example: US Polio Data</a></li>
<li class="chapter" data-level="2.10" data-path="estimation.html"><a href="estimation.html#estimation-of-phi"><i class="fa fa-check"></i><b>2.10</b> Estimation of <span class="math inline">\(\phi\)</span></a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="estimation.html"><a href="estimation.html#special-cases"><i class="fa fa-check"></i><b>2.10.1</b> Special Cases</a></li>
<li class="chapter" data-level="2.10.2" data-path="estimation.html"><a href="estimation.html#practical-example-hospital-stay-data"><i class="fa fa-check"></i><b>2.10.2</b> Practical Example: Hospital Stay Data</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="estimation.html"><a href="estimation.html#asymptotic-properties-of-hatboldsymbolbeta"><i class="fa fa-check"></i><b>2.11</b> Asymptotic Properties of <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span></a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="estimation.html"><a href="estimation.html#fisher-scoring"><i class="fa fa-check"></i><b>2.11.1</b> Fisher Scoring</a></li>
<li class="chapter" data-level="2.11.2" data-path="estimation.html"><a href="estimation.html#expectation"><i class="fa fa-check"></i><b>2.11.2</b> Expectation</a></li>
<li class="chapter" data-level="2.11.3" data-path="estimation.html"><a href="estimation.html#variance"><i class="fa fa-check"></i><b>2.11.3</b> Variance</a></li>
<li class="chapter" data-level="2.11.4" data-path="estimation.html"><a href="estimation.html#asymptotic-normality"><i class="fa fa-check"></i><b>2.11.4</b> Asymptotic Normality</a></li>
<li class="chapter" data-level="2.11.5" data-path="estimation.html"><a href="estimation.html#closing-the-circle"><i class="fa fa-check"></i><b>2.11.5</b> Closing The Circle</a></li>
<li class="chapter" data-level="2.11.6" data-path="estimation.html"><a href="estimation.html#next-step"><i class="fa fa-check"></i><b>2.11.6</b> Next Step</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html"><i class="fa fa-check"></i><b>3</b> Prediction and Inference</a>
<ul>
<li class="chapter" data-level="3.1" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#prediction2"><i class="fa fa-check"></i><b>3.1</b> Prediction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#example-hospital-stay-data"><i class="fa fa-check"></i><b>3.1.1</b> Example: Hospital Stay Data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#hypothesis-tests"><i class="fa fa-check"></i><b>3.2</b> Hypothesis Tests</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#simple-tests"><i class="fa fa-check"></i><b>3.2.1</b> Simple Tests</a></li>
<li class="chapter" data-level="3.2.2" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#generalisation-to-nested-models"><i class="fa fa-check"></i><b>3.2.2</b> Generalisation to Nested Models</a></li>
<li class="chapter" data-level="3.2.3" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#example-hospital-stay-data-1"><i class="fa fa-check"></i><b>3.2.3</b> Example: Hospital Stay Data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#confidence-regions-for-hatboldsymbolbeta"><i class="fa fa-check"></i><b>3.3</b> Confidence Regions for <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span></a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#alpha-hessian-cr"><i class="fa fa-check"></i><b>3.3.1</b> <span class="math inline">\((1 - \alpha)\)</span> Hessian CR</a></li>
<li class="chapter" data-level="3.3.2" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#alpha-method-of-support-cr"><i class="fa fa-check"></i><b>3.3.2</b> <span class="math inline">\((1 - \alpha)\)</span> <em>method of support</em> CR</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#issues-with-glms-and-the-wald-test"><i class="fa fa-check"></i><b>3.4</b> Issues with GLMs and the Wald Test</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#separation"><i class="fa fa-check"></i><b>3.4.1</b> Separation</a></li>
<li class="chapter" data-level="3.4.2" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#hauck-donner-effect"><i class="fa fa-check"></i><b>3.4.2</b> Hauck-Donner Effect</a></li>
<li class="chapter" data-level="3.4.3" data-path="prediction_and_inference.html"><a href="prediction_and_inference.html#next-step-1"><i class="fa fa-check"></i><b>3.4.3</b> Next Step</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html"><i class="fa fa-check"></i><b>4</b> Deviance</a>
<ul>
<li class="chapter" data-level="4.1" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#goodness-of-fit"><i class="fa fa-check"></i><b>4.1</b> Goodness-of-Fit</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#the-saturated-model"><i class="fa fa-check"></i><b>4.1.1</b> The Saturated Model</a></li>
<li class="chapter" data-level="4.1.2" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#deviance"><i class="fa fa-check"></i><b>4.1.2</b> Deviance</a></li>
<li class="chapter" data-level="4.1.3" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#example-special-cases"><i class="fa fa-check"></i><b>4.1.3</b> Example Special Cases</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#asymptotic-properties"><i class="fa fa-check"></i><b>4.2</b> Asymptotic Properties</a></li>
<li class="chapter" data-level="4.3" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#pearson-statistic"><i class="fa fa-check"></i><b>4.3</b> Pearson Statistic</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#relation-to-deviance"><i class="fa fa-check"></i><b>4.3.1</b> Relation to Deviance</a></li>
<li class="chapter" data-level="4.3.2" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#pearson-residuals"><i class="fa fa-check"></i><b>4.3.2</b> Pearson Residuals</a></li>
<li class="chapter" data-level="4.3.3" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#example-us-polio-data"><i class="fa fa-check"></i><b>4.3.3</b> Example: US Polio Data</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#residuals-and-diagnostics"><i class="fa fa-check"></i><b>4.4</b> Residuals and Diagnostics</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#example-hospital-stay-data-2"><i class="fa fa-check"></i><b>4.4.1</b> Example: Hospital Stay Data</a></li>
<li class="chapter" data-level="4.4.2" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#example-us-polio-data-1"><i class="fa fa-check"></i><b>4.4.2</b> Example: US Polio Data</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#analysis-of-deviance"><i class="fa fa-check"></i><b>4.5</b> Analysis of Deviance</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#interpretation-and-testing"><i class="fa fa-check"></i><b>4.5.1</b> Interpretation and Testing</a></li>
<li class="chapter" data-level="4.5.2" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#general-case"><i class="fa fa-check"></i><b>4.5.2</b> General Case</a></li>
<li class="chapter" data-level="4.5.3" data-path="deviance_and_diagnostics.html"><a href="deviance_and_diagnostics.html#example-hospital-stay-data-3"><i class="fa fa-check"></i><b>4.5.3</b> Example: Hospital Stay Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="quasi_likelihood.html"><a href="quasi_likelihood.html"><i class="fa fa-check"></i><b>5</b> Quasi-Likelihood Methods</a>
<ul>
<li class="chapter" data-level="5.1" data-path="quasi_likelihood.html"><a href="quasi_likelihood.html#dispersion"><i class="fa fa-check"></i><b>5.1</b> Dispersion</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="quasi_likelihood.html"><a href="quasi_likelihood.html#example-hospital-stay-data-4"><i class="fa fa-check"></i><b>5.1.1</b> Example: Hospital Stay Data</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="quasi_likelihood.html"><a href="quasi_likelihood.html#overdispersion"><i class="fa fa-check"></i><b>5.2</b> Overdispersion</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="quasi_likelihood.html"><a href="quasi_likelihood.html#example-us-polio-data-2"><i class="fa fa-check"></i><b>5.2.1</b> Example: US Polio Data</a></li>
<li class="chapter" data-level="5.2.2" data-path="quasi_likelihood.html"><a href="quasi_likelihood.html#example-us-polio-data-3"><i class="fa fa-check"></i><b>5.2.2</b> Example: US Polio Data</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="quasi_likelihood.html"><a href="quasi_likelihood.html#generalized-estimating-equations"><i class="fa fa-check"></i><b>5.3</b> Generalized Estimating Equations</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="quasi_likelihood.html"><a href="quasi_likelihood.html#uspolioexample"><i class="fa fa-check"></i><b>5.3.1</b> Example: US Polio Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="marginal_models.html"><a href="marginal_models.html"><i class="fa fa-check"></i><b>6</b> Marginal models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="marginal_models.html"><a href="marginal_models.html#repeated-measures-data"><i class="fa fa-check"></i><b>6.1</b> Repeated measures data</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="marginal_models.html"><a href="marginal_models.html#oxfordboysdata"><i class="fa fa-check"></i><b>6.1.1</b> Example: Oxford boys data</a></li>
<li class="chapter" data-level="6.1.2" data-path="marginal_models.html"><a href="marginal_models.html#mathsdata"><i class="fa fa-check"></i><b>6.1.2</b> Example: Mathematics achievement data</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="marginal_models.html"><a href="marginal_models.html#modeldef"><i class="fa fa-check"></i><b>6.2</b> The marginal model for repeated measures</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="marginal_models.html"><a href="marginal_models.html#some-examples"><i class="fa fa-check"></i><b>6.2.1</b> Some examples</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="marginal_models.html"><a href="marginal_models.html#mmestimation"><i class="fa fa-check"></i><b>6.3</b> Estimation</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="marginal_models.html"><a href="marginal_models.html#example-1"><i class="fa fa-check"></i><b>6.3.1</b> Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html"><i class="fa fa-check"></i><b>7</b> Linear mixed models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#random-intercept-models"><i class="fa fa-check"></i><b>7.1</b> Random intercept models</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#example-oxford-boys-data"><i class="fa fa-check"></i><b>7.1.1</b> Example: Oxford boys data</a></li>
<li class="chapter" data-level="7.1.2" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#example-oxford-boys-data-1"><i class="fa fa-check"></i><b>7.1.2</b> Example: Oxford boys data</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#random-slope-models"><i class="fa fa-check"></i><b>7.2</b> Random slope models</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#example-oxford-boys-data-2"><i class="fa fa-check"></i><b>7.2.1</b> Example: Oxford boys data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#the-linear-mixed-model-lmm"><i class="fa fa-check"></i><b>7.3</b> The linear mixed model (LMM)</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#examples"><i class="fa fa-check"></i><b>7.3.1</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#estimation-of-fixed-effects"><i class="fa fa-check"></i><b>7.4</b> Estimation of fixed effects</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#remlexamples"><i class="fa fa-check"></i><b>7.4.1</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#inference-for-fixed-effects"><i class="fa fa-check"></i><b>7.5</b> Inference for fixed effects</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#example-mathematics-achievement-data"><i class="fa fa-check"></i><b>7.5.1</b> Example: Mathematics achievement data</a></li>
<li class="chapter" data-level="7.5.2" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#example-mathematics-achievement-data-1"><i class="fa fa-check"></i><b>7.5.2</b> Example: Mathematics achievement data</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#prediction-of-random-effects"><i class="fa fa-check"></i><b>7.6</b> Prediction of random effects</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#example-mathematics-achievement-data-2"><i class="fa fa-check"></i><b>7.6.1</b> Example: Mathematics achievement data</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#inference-for-random-effects"><i class="fa fa-check"></i><b>7.7</b> Inference for random effects</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="linear_mixed_models.html"><a href="linear_mixed_models.html#example-mathematics-achievement-data-3"><i class="fa fa-check"></i><b>7.7.1</b> Example: Mathematics achievement data</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Statistical Modelling III (second term)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="marginal_models" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Marginal models<a href="marginal_models.html#marginal_models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="repeated-measures-data" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Repeated measures data<a href="marginal_models.html#repeated-measures-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="oxfordboysdata" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Example: Oxford boys data<a href="marginal_models.html#oxfordboysdata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We consider a data set giving repeated measures of height (cm) of 26 boys over eight time points (i.e. total sample size <span class="math inline">\(N=234\)</span>).</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="marginal_models.html#cb145-1" tabindex="-1"></a><span class="fu">require</span>(nlme)</span></code></pre></div>
<pre><code>## Loading required package: nlme</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="marginal_models.html#cb147-1" tabindex="-1"></a><span class="fu">data</span>(Oxboys)</span>
<span id="cb147-2"><a href="marginal_models.html#cb147-2" tabindex="-1"></a><span class="co"># ?Oxboys</span></span></code></pre></div>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="marginal_models.html#cb148-1" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span></code></pre></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="marginal_models.html#cb150-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Oxboys, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> height, <span class="at">col =</span> Subject)) <span class="sc">+</span></span>
<span id="cb150-2"><a href="marginal_models.html#cb150-2" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb150-3"><a href="marginal_models.html#cb150-3" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Height vs. Age&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Different look at the data:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="marginal_models.html#cb151-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Oxboys, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> height, <span class="at">col =</span> Subject)) <span class="sc">+</span></span>
<span id="cb151-2"><a href="marginal_models.html#cb151-2" tabindex="-1"></a>       <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb151-3"><a href="marginal_models.html#cb151-3" tabindex="-1"></a>       <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Height vs. Age&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;by subject&quot;</span>) <span class="sc">+</span></span>
<span id="cb151-4"><a href="marginal_models.html#cb151-4" tabindex="-1"></a>       <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Clearly, there is within-subject correlation: Measures from one subject are more similar to each other than those from different subjects.</p>
<p>This is a special type of repeated measures data which is commonly referred to as <strong>longitudinal data</strong>: Repeated measures on certain individuals over time.</p>
</div>
<div id="mathsdata" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Example: Mathematics achievement data<a href="marginal_models.html#mathsdata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The data used here represent Mathematics achievement scores of a subsample of subjects from the 1982 High School and Beyond Survey. The full dataset can be found within the package <a href="https://rdrr.io/cran/merTools/man/hsb.html">merTools</a>.</p>
<p>For each of 30 schools, we have pupil-level data on Mathematics achievement and a few covariates including socioeconomic status.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="marginal_models.html#cb152-1" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;Datasets/sub_hsb.RData&quot;</span>) <span class="co"># Insert directory</span></span>
<span id="cb152-2"><a href="marginal_models.html#cb152-2" tabindex="-1"></a><span class="fu">head</span>(sub_hsb)</span></code></pre></div>
<pre><code>##   schid minority female    ses mathach size schtype meanses
## 1  1224        0      1 -1.528   5.876  842       0  -0.428
## 2  1224        0      1 -0.588  19.708  842       0  -0.428
## 3  1224        0      0 -0.528  20.349  842       0  -0.428
## 4  1224        0      0 -0.668   8.781  842       0  -0.428
## 5  1224        0      0 -0.158  17.898  842       0  -0.428
## 6  1224        0      0  0.022   4.583  842       0  -0.428</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="marginal_models.html#cb154-1" tabindex="-1"></a><span class="fu">dim</span>(sub_hsb)</span></code></pre></div>
<pre><code>## [1] 1329    8</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="marginal_models.html#cb156-1" tabindex="-1"></a>school.id <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(sub_hsb<span class="sc">$</span>schid)</span>
<span id="cb156-2"><a href="marginal_models.html#cb156-2" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">levels</span>(school.id))</span></code></pre></div>
<pre><code>## [1] 30</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="marginal_models.html#cb158-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_hsb, <span class="fu">aes</span>(<span class="at">x =</span> ses, <span class="at">y =</span> mathach)) <span class="sc">+</span></span>
<span id="cb158-2"><a href="marginal_models.html#cb158-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb158-3"><a href="marginal_models.html#cb158-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">col =</span> <span class="st">&quot;Red&quot;</span>)<span class="sc">+</span></span>
<span id="cb158-4"><a href="marginal_models.html#cb158-4" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mathematics achievement vs. Socioeconomic status (SES)&quot;</span>) <span class="sc">+</span></span>
<span id="cb158-5"><a href="marginal_models.html#cb158-5" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;SES&quot;</span>) <span class="sc">+</span></span>
<span id="cb158-6"><a href="marginal_models.html#cb158-6" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Mathematics achievement&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="marginal_models.html#cb160-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_hsb, <span class="fu">aes</span>(<span class="at">x =</span> ses, <span class="at">y =</span> mathach, <span class="at">colour =</span> school.id)) <span class="sc">+</span></span>
<span id="cb160-2"><a href="marginal_models.html#cb160-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb160-3"><a href="marginal_models.html#cb160-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb160-4"><a href="marginal_models.html#cb160-4" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mathematics achievement vs. Socioeconomic status (SES)&quot;</span>,</span>
<span id="cb160-5"><a href="marginal_models.html#cb160-5" tabindex="-1"></a>          <span class="at">subtitle =</span><span class="st">&quot;by cluster (school)&quot;</span>) <span class="sc">+</span></span>
<span id="cb160-6"><a href="marginal_models.html#cb160-6" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;SES&quot;</span>) <span class="sc">+</span></span>
<span id="cb160-7"><a href="marginal_models.html#cb160-7" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Mathematics achievement&quot;</span>) <span class="sc">+</span></span>
<span id="cb160-8"><a href="marginal_models.html#cb160-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>One will suspect from these plots that there is within-school-correlation: Pupils from one school tend tend to be more similar to each other than to pupils from different schools.</p>
<p>This type of repeated measures data is commonly referred to as “clustered” data, with clusters here referring to schools. Note that the term clustered is here just to be interpreted in the sense of “items of increased similarity due to a structural reason”, but it has nothing to do with “clustering” such as for instance k-means.</p>
<hr />
<p>Fitting naïve LMs or GLMs to repeated measures data may or may not result in correct inferences for <span class="math inline">\(\boldsymbol{\beta}\)</span>, but in any case the standard errors <span class="math inline">\(SE(\hat{\beta}_j)\)</span> will be incorrect. Fortunately, longitudinal and clustered data can be dealt with in the same framework.</p>
</div>
</div>
<div id="modeldef" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> The marginal model for repeated measures<a href="marginal_models.html#modeldef" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Denote <span class="math inline">\(y_{ij}\)</span>, <span class="math inline">\(i=1, \ldots,n\)</span>, <span class="math inline">\(j=1, \ldots, n_i\)</span>, the <span class="math inline">\(j\)</span>th repeated measurement for cluster/individual <span class="math inline">\(i\)</span> (we will just speak of “cluster” henceforth), so that the total sample size is <span class="math inline">\(N=\sum_{i=1}^n n_i\)</span>. Denote further the vector of all responses (repeated messurements) belonging
to the <span class="math inline">\(i\)</span>th cluster by
<span class="math display">\[
\boldsymbol{Y}_i=\left(\begin{array}{c} y_{i1}\\ \vdots \\ y_{in_i}\end{array}\right),
\]</span>
with associated covariates
<span class="math display">\[
\boldsymbol{X}_i= \left(\begin{array}{c} \boldsymbol{x}_{i1}^T \\ \vdots \\\boldsymbol{x}_{in_i}^T\end{array} \right) =
\left(\begin{array}{ccc}  x_{i11}&amp;  \ldots &amp; x_{i1p}\\
                          \vdots    &amp; \ddots  &amp; \vdots  \\
                          x_{in_i1} &amp; \ldots &amp; x_{in_ip}  \end{array}\right).
\]</span></p>
<p>A <strong>marginal model</strong> for <span class="math inline">\(y_{ij}\)</span> has three components:</p>
<ul>
<li>the mean function (“correctly specified”)
<span class="math display">\[
\mu_{ij}=E(y_{ij})=h(\boldsymbol{\beta}^T \boldsymbol{x}_{ij});
\]</span></li>
<li>the mean-variance relationship
<span class="math display">\[
\mbox{Var}(y_{ij})=\phi\mathcal{V}(\mu_{ij});
\]</span></li>
<li>the association between the responses
<span class="math display">\[
\begin{aligned}
\mbox{corr}(y_{ij}, y_{i&#39;k}) &amp;= 0 \,\, \mbox{ for all } \,\, i\not=i&#39; \\
\mbox{corr}(y_{ij}, y_{ik}) &amp;= r_{jk} (\boldsymbol\alpha),
\end{aligned}
\]</span></li>
</ul>
<p>where <span class="math inline">\(r_{jk}(\cdot)\)</span> is a known function indexed by <span class="math inline">\(j,k=1, \ldots n_i\)</span>,
and <span class="math inline">\(\boldsymbol{\alpha}\)</span> is a set of parameters.</p>
<p>The specified variances and correlations of the <span class="math inline">\(y_{ij}\)</span> define uniquely the variance
matrix <span class="math inline">\(\boldsymbol{\Sigma}_i\)</span> of the elements of the <span class="math inline">\(i\)</span>th cluster.</p>
<p>The most common settings of the function <span class="math inline">\(r_{jk}(\cdot)\)</span> are as follows:</p>
<ul>
<li>“Independence”. Here <span class="math inline">\(r_{jk}(\boldsymbol{\alpha})\equiv r_{jk}\)</span> does not depend on parameters, where
<span class="math display">\[
r_{jk} =\left\{\begin{array}{ll} 1 &amp; j=k \\ 0 &amp; j \not= k \end{array}\right.
\]</span></li>
<li>“Exchangeable” or “Equicorrelation”: For <span class="math inline">\(\boldsymbol{\alpha}=\alpha \in \mathbb{R}\)</span>,
<span class="math display">\[
r_{jk}(\alpha)= \left\{\begin{array}{ll} 1 &amp; j=k \\ \alpha &amp; j \not= k \end{array}\right.
\]</span></li>
<li>“Autoregressive model” (AR-1): For <span class="math inline">\(\boldsymbol{\alpha}=\alpha \in \mathbb{R}\)</span>,
<span class="math display">\[
r_{jk}(\alpha)= \alpha^{|j-k|}
\]</span></li>
<li>“Unstructured”: For <span class="math inline">\(n_i \equiv n^*\)</span> for all <span class="math inline">\(i\)</span>, then with <span class="math inline">\(\boldsymbol{\alpha} \in \mathbb{R}^{n^* \times n^*}\)</span>, and
<span class="math display">\[
r_{jk}(\boldsymbol{\alpha})= \boldsymbol{\alpha}_{jk}
\]</span></li>
</ul>
<p>Some notes:</p>
<ul>
<li>There is no distributional assumption and there is no likelihood (Beyond the repeated measures context, this approach is also useful for complex modelling scenarios
where building a likelihood may be very hard)</li>
<li><span class="math inline">\(\boldsymbol{\alpha}\)</span> and <span class="math inline">\(\boldsymbol{\beta}\)</span> are overall model parameters which do not depend on the cluster, <span class="math inline">\(i\)</span>.</li>
<li>Marginal models provide “population-averaged” effects (unlike “conditional effects”, which provide effects conditional on each cluster <span class="math inline">\(i\)</span>, as we will see later for the mixed models).</li>
</ul>
<p>What can we say about the matrices <span class="math inline">\(\boldsymbol{\Sigma}_i\)</span>?</p>
<ul>
<li>Firstly, element-wise, combining the specifications of variances and correlations, we have
<span class="math display">\[
\mbox{Cov}(y_{ij}, y_{ik})= \phi r_{jk}(\boldsymbol{\alpha})\sqrt{\mathcal{V}(\mu_{ij})}\sqrt{\mathcal{V}(\mu_{ik})}.
\]</span></li>
<li>Globally, defining the <strong>working correlation matrix</strong>
<span class="math display">\[
R_i(\boldsymbol{\alpha})= (r_{jk}(\boldsymbol{\alpha}))_{1\le j \le n_i, 1 \le k \le n_i}
\]</span>
and
<span class="math display">\[
C_i(\boldsymbol{\beta}, \phi)= \mbox{diag}(\phi \mathcal{V}(\mu_{ij})),
\]</span>
one has
<span class="math display">\[
\boldsymbol{\Sigma}_i=C_i^{1/2}(\boldsymbol{\beta}, \phi)R_i(\boldsymbol{\alpha})C_i^{1/2}(\boldsymbol{\beta}, \phi)
\]</span>
(clearly depends on <span class="math inline">\(\boldsymbol{\alpha}\)</span>, <span class="math inline">\(\boldsymbol{\beta}\)</span>, <span class="math inline">\(\phi\)</span>).</li>
</ul>
<div id="some-examples" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Some examples<a href="marginal_models.html#some-examples" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We exemplify the model structure through some of our recent data examples.</p>
<ul>
<li><p>US Polio data (Section <a href="quasi_likelihood.html#uspolioexample">5.3.1</a>)
<span class="math display">\[
\begin{aligned}
\mu_{ij}&amp;=&amp; \exp(\beta_0+\beta_1t_{ij})\\
\mathcal{V}(\mu_{ij})&amp;=&amp;\mu_{ij}\\
r_{jk}(\alpha)&amp;=&amp; \alpha^{|j-k|}\\
\mbox{Cov}(y_{ij}, y_{ik})&amp;=&amp;\phi \alpha^{|j-k|}\sqrt{\mu_{ij}\mu_{ik}}
\end{aligned}
\]</span></p></li>
<li><p>Oxford boys data (Section <a href="marginal_models.html#oxfordboysdata">6.1.1</a>)
<span class="math display">\[
\begin{aligned}
\mu_{ij}&amp;=&amp; \beta_0+\beta_1t_{ij}\\
\mathcal{V}(\mu_{ij})&amp;=&amp;1, \mbox{   where } \phi\equiv \sigma^2 \\
r_{jk}(\alpha)&amp;=&amp; \alpha^{|j-k|}\\
\mbox{Cov}(y_{ij}, y_{ik})&amp;=&amp; \sigma^2 \alpha^{|j-k|}
\end{aligned}
\]</span></p></li>
<li><p>Mathematics achievement data (Section <a href="marginal_models.html#mathsdata">6.1.2</a>)
<span class="math display">\[
\begin{aligned}
\mu_{ij}&amp;=&amp; \beta_0+\beta_1\mbox{ses}_{ij}\\
\mathcal{V}(\mu_{ij})&amp;=&amp;1, \mbox{   where } \phi\equiv \sigma^2 \\
r_{jk}(\alpha)&amp;=&amp; \left\{
\begin{array}{lc}\alpha \,&amp;\mbox{ if } j \not=k\\
              1      \,&amp;\mbox{ if } j =k
\end{array}\right.\\
\mbox{Cov}(y_{ij}, y_{ik})&amp;=&amp;\left\{
\begin{array}{lc}\alpha\sigma^2\,&amp;\mbox{ if } j \not=k\\
                \sigma^2      \,&amp;\mbox{ if } j =k
\end{array}\right.
\end{aligned}
\]</span></p></li>
</ul>
</div>
</div>
<div id="mmestimation" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Estimation<a href="marginal_models.html#mmestimation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>All what is needed to estimate the model elaborated above is the (generalized version of the) Quasi-Score function
<span class="math display">\[
S(\boldsymbol{\beta})= \boldsymbol{X}^T\boldsymbol{D}\boldsymbol{\Sigma}^{-1}(\boldsymbol{Y}-\boldsymbol{\mu})
\]</span>
where</p>
<p><span class="math display">\[
\boldsymbol{Y}=\left(\begin{array}{c}\boldsymbol{Y}_1\\
              \vdots\\
              \boldsymbol{Y}_n\end{array}\right) \in \mathbb{R}^N,\,\,\,
\boldsymbol{X} = \left(\begin{array}{c}\boldsymbol{X}_1\\
              \vdots\\
              \boldsymbol{X}_n\end{array}\right) \in \mathbb{R}^{N \times p},\,\,\,         \boldsymbol{\mu} = \left(\begin{array}{c}\boldsymbol{\mu}_1\\
              \vdots\\
              \boldsymbol{\mu}_n\end{array}\right) \in \mathbb{R}^{N},\,\,\,
\]</span>
where <span class="math inline">\(\boldsymbol{Y}_i\)</span> and <span class="math inline">\(\boldsymbol{X}_i\)</span> are as defined in Section <a href="marginal_models.html#modeldef">6.2</a>, and
<span class="math inline">\(\boldsymbol{\mu}_i= (\mu_{i1}, \ldots, \mu_{in_i})^T\)</span>, with <span class="math inline">\(\mu_{ij}=h(\boldsymbol\beta^T \boldsymbol{x}_{ij})\)</span> and <span class="math inline">\(\boldsymbol{\beta} \in \mathbb{R}^p\)</span>. Furthermore,</p>
<p><span class="math display">\[
\boldsymbol{D} =
\left(\begin{array}{cccc}
h&#39;(\boldsymbol\beta^T \boldsymbol{x}_{11}) &amp; &amp; &amp; \\
&amp; h&#39;(\boldsymbol\beta^T \boldsymbol{x}_{12}) &amp; &amp; \\
&amp; &amp; \ddots &amp; \\
&amp; &amp; &amp; h&#39;(\boldsymbol\beta^T \boldsymbol{x}_{nn_n})
\end{array}\right) \in \mathbb{R}^{N\times N},\,
\boldsymbol\Sigma =
\left(\begin{array}{cccc}
\boldsymbol\Sigma_1 &amp; &amp; &amp; \\
&amp; \boldsymbol\Sigma_2 &amp; &amp; \\
&amp; &amp; \ddots &amp; \\
&amp; &amp; &amp; \boldsymbol\Sigma_n
\end{array}\right) \in \mathbb{R}^{N \times N},
\]</span></p>
<p>noting that <span class="math inline">\(\boldsymbol\Sigma_i \in \mathbb{R}^{n_i \times n_i}\)</span>.
Setting these to 0 yields the <strong>generalized estimating equation</strong> (GEE),
<span class="math display">\[
\boldsymbol{X}^T\boldsymbol{D}\boldsymbol{\Sigma}^{-1}(\boldsymbol{Y}-\boldsymbol{\mu})=0
\]</span></p>
<ul>
<li><p>If <span class="math inline">\(\boldsymbol{\Sigma}\)</span> is known (and correctly specified) up to a multiplicative
function of <span class="math inline">\(\phi\)</span> (but <em>not</em> depending on further parameters, <span class="math inline">\(\boldsymbol{\alpha}\)</span>), then solve the GEE via Iteratively Weighted Least Squares (IWLS). That is, in complete analogy to the GLM estimation routines in Section <a href="estimation.html#iterativesolution">2.8</a>, one has
<span class="math display">\[
\hat{\boldsymbol{\beta}}_{m+1}=(\boldsymbol{X}^T\boldsymbol{D}\boldsymbol{\Sigma}^{-1}\boldsymbol{D}\boldsymbol{X})^{-1}\boldsymbol{X}^T\boldsymbol{D}\boldsymbol{\Sigma}^{-1}\boldsymbol{D}\hat{\boldsymbol{Y}}_m
\]</span>
where <span class="math inline">\(\hat{\boldsymbol{Y}}_m\)</span> is a vector of working observations (which is also the same as in Section <a href="estimation.html#iterativesolution">2.8</a>).
If <span class="math inline">\(\boldsymbol{Y}\)</span> is in fact multivariate normal and <span class="math inline">\(h(\cdot)\)</span> the identity link (so <span class="math inline">\(\boldsymbol{D}=\boldsymbol{I}\)</span>), then <em>one</em> iteration <span class="math inline">\((\boldsymbol{X}^T\boldsymbol{\Sigma}^{-1}\boldsymbol{X})^{-1}\boldsymbol{X}^T\boldsymbol{\Sigma}^{-1}\boldsymbol{Y}\)</span> is sufficient. In either case, estimation of <span class="math inline">\(\boldsymbol{\beta}\)</span> does not depend on <span class="math inline">\(\phi\)</span>, so <span class="math inline">\(\phi\)</span> can be estimated separately after the last iteration.</p></li>
<li><p>Otherwise (if <span class="math inline">\(\boldsymbol{\Sigma}\)</span> depends on unknown parameters <span class="math inline">\(\boldsymbol{\alpha}\)</span>), cycle between:</p></li>
</ul>
<ol style="list-style-type: decimal">
<li>Given current <span class="math inline">\(\hat{\boldsymbol{\alpha}}\)</span> and <span class="math inline">\(\hat{\phi}\)</span>, estimate <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> by (one iteration of) IWLS;</li>
<li>Given current <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span>, estimate <span class="math inline">\(\hat{\boldsymbol{\alpha}}\)</span> and <span class="math inline">\(\hat{\phi}\)</span> [explicit formulas in <span class="citation">Fahrmeir and Tutz (<a href="#ref-fahrmeir2001multivariate">2001</a>)</span>; page 125].</li>
</ol>
<p>Variance estimation (under either scenario):</p>
<ul>
<li>“naïve”:
<span class="math display">\[
\mbox{Var}(\hat{\boldsymbol{\beta}})= (\boldsymbol{X}^T\boldsymbol{D}\boldsymbol{\Sigma}^{-1}\boldsymbol{D}\boldsymbol{X})^{-1}\equiv \boldsymbol{F}^{-1}
\]</span></li>
<li>“robust”: Sandwich variance estimator
<span class="math display">\[
\mbox{Var}_s(\hat{\boldsymbol{\beta}})= \boldsymbol{F}^{-1}\boldsymbol{V}\boldsymbol{F}^{-1}
\]</span>
where <span class="math inline">\(\boldsymbol{V}=\boldsymbol{X}^T\boldsymbol{D}\boldsymbol{\Sigma}^{-1}\boldsymbol{S}\boldsymbol{\Sigma}^{-1}\boldsymbol{D}\boldsymbol{X}\)</span>, and <span class="math inline">\(\boldsymbol{S}\)</span> is the so-called “true” variance matrix estimated as
<span class="math display">\[
\boldsymbol{S}=
\left(\begin{array}{ccc}\boldsymbol{S}_1 &amp;&amp;\\
                                    &amp; \ddots &amp; \\
                            &amp;&amp; \boldsymbol{S}_n
\end{array}\right) \in \mathbb{R}^{N \times N}.
\]</span>
with <span class="math inline">\(\boldsymbol{S}_i=(\boldsymbol{Y}_i-\hat{\boldsymbol{\mu}}_i)(\boldsymbol{Y}_i-\hat{\boldsymbol{\mu}}_i)^T\)</span>.</li>
</ul>
<p>Theoretical properties [<span class="citation">Fahrmeir and Tutz (<a href="#ref-fahrmeir2001multivariate">2001</a>)</span>; page 126/127]:</p>
<p>Under some regularity conditions, <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> is consistent (i.e. <span class="math inline">\(\hat{\boldsymbol{\beta}} \longrightarrow \boldsymbol{\beta}\)</span> for <span class="math inline">\(N \longrightarrow \infty\)</span>) and asymptotically normal,
<span class="math display">\[
\hat{\boldsymbol{\beta}} \sim \mathcal{N}(\boldsymbol{\beta}, \boldsymbol{F}^{-1}\boldsymbol{V}\boldsymbol{F}^{-1} )
\]</span>
even if the specification of <span class="math inline">\(\boldsymbol{\Sigma}\)</span> is wrong. Correct specification of <span class="math inline">\(\boldsymbol{\mu}\)</span> is therefore more important than that of <span class="math inline">\(\boldsymbol{\Sigma}\)</span>.</p>
<div id="example-1" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Example<a href="marginal_models.html#example-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>GEE for Mathematics achievement data:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="marginal_models.html#cb161-1" tabindex="-1"></a><span class="fu">require</span>(gee)</span>
<span id="cb161-2"><a href="marginal_models.html#cb161-2" tabindex="-1"></a>hsb.gee <span class="ot">&lt;-</span> <span class="fu">gee</span>(mathach <span class="sc">~</span> ses, <span class="at">data =</span> sub_hsb, </span>
<span id="cb161-3"><a href="marginal_models.html#cb161-3" tabindex="-1"></a>               <span class="at">id=</span>school.id, <span class="at">corstr =</span> <span class="st">&quot;exchangeable&quot;</span>)</span></code></pre></div>
<pre><code>## Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27</code></pre>
<pre><code>## running glm to get initial regression estimate</code></pre>
<pre><code>## (Intercept)         ses 
##   12.886358    3.453019</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="marginal_models.html#cb165-1" tabindex="-1"></a>hsb.gee</span></code></pre></div>
<pre><code>## 
##  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA
##  gee S-function, version 4.13 modified 98/01/27 (1998) 
## 
## Model:
##  Link:                      Identity 
##  Variance to Mean Relation: Gaussian 
##  Correlation Structure:     Exchangeable 
## 
## Call:
## gee(formula = mathach ~ ses, id = school.id, data = sub_hsb, 
##     corstr = &quot;exchangeable&quot;)
## 
## Number of observations :  1329 
## 
## Maximum cluster size   :  67 
## 
## 
## Coefficients:
## (Intercept)         ses 
##   12.884541    2.170503 
## 
## Estimated Scale Parameter:  41.85127
## Number of Iterations:  4
## 
## Working Correlation[1:4,1:4]
##           [,1]      [,2]      [,3]      [,4]
## [1,] 1.0000000 0.1253383 0.1253383 0.1253383
## [2,] 0.1253383 1.0000000 0.1253383 0.1253383
## [3,] 0.1253383 0.1253383 1.0000000 0.1253383
## [4,] 0.1253383 0.1253383 0.1253383 1.0000000
## 
## 
## Returned Error Value:
## [1] 0</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="marginal_models.html#cb167-1" tabindex="-1"></a><span class="co"># Compare to linear regression</span></span>
<span id="cb167-2"><a href="marginal_models.html#cb167-2" tabindex="-1"></a>hsb.lm<span class="ot">&lt;-</span> <span class="fu">lm</span>(mathach <span class="sc">~</span> ses, <span class="at">data =</span> sub_hsb)</span></code></pre></div>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="marginal_models.html#cb168-1" tabindex="-1"></a>sub_hsb<span class="sc">$</span>pred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(hsb.gee)</span>
<span id="cb168-2"><a href="marginal_models.html#cb168-2" tabindex="-1"></a></span>
<span id="cb168-3"><a href="marginal_models.html#cb168-3" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_hsb, <span class="fu">aes</span>(<span class="at">x =</span> ses, <span class="at">y =</span> mathach)) <span class="sc">+</span></span>
<span id="cb168-4"><a href="marginal_models.html#cb168-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb168-5"><a href="marginal_models.html#cb168-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">col =</span> <span class="st">&quot;Red&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-6"><a href="marginal_models.html#cb168-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> ses, <span class="at">y =</span> pred1), <span class="at">col =</span> <span class="st">&quot;Blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-7"><a href="marginal_models.html#cb168-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mathematics achievement vs. Socioeconomic status (SES)&quot;</span>,</span>
<span id="cb168-8"><a href="marginal_models.html#cb168-8" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">&quot;Blue line is GEE solution&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-9"><a href="marginal_models.html#cb168-9" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;SES&quot;</span>) <span class="sc">+</span></span>
<span id="cb168-10"><a href="marginal_models.html#cb168-10" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Mathematics achievement&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>What about standard errors?</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="marginal_models.html#cb170-1" tabindex="-1"></a><span class="fu">summary</span>(hsb.gee)<span class="sc">$</span>coef</span></code></pre></div>
<pre><code>##              Estimate Naive S.E.   Naive z Robust S.E. Robust z
## (Intercept) 12.884541  0.4524909 28.474697   0.4784090 26.93206
## ses          2.170503  0.2538904  8.548976   0.3576248  6.06922</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="marginal_models.html#cb172-1" tabindex="-1"></a><span class="co"># Compare to linear regression</span></span>
<span id="cb172-2"><a href="marginal_models.html#cb172-2" tabindex="-1"></a><span class="fu">summary</span>(hsb.lm)<span class="sc">$</span>coef</span></code></pre></div>
<pre><code>##              Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 12.886358  0.1752970 73.51156 0.000000e+00
## ses          3.453019  0.2222153 15.53907 3.738528e-50</code></pre>
<p>Observations:</p>
<ul>
<li>Both the actual estimates, and their standard errors, are quite different for the GEE and the LM.</li>
<li>The robust standard errors are still a bit larger than the naive ones.</li>
</ul>
<p>GEE for Oxford boys data:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="marginal_models.html#cb174-1" tabindex="-1"></a><span class="fu">data</span>(Oxboys, <span class="at">package=</span><span class="st">&quot;nlme&quot;</span>)</span>
<span id="cb174-2"><a href="marginal_models.html#cb174-2" tabindex="-1"></a>oxboys.gee <span class="ot">&lt;-</span> <span class="fu">gee</span>(height<span class="sc">~</span>age, <span class="at">data=</span>Oxboys, <span class="at">id=</span>Subject, <span class="at">corstr=</span><span class="st">&quot;AR-M&quot;</span>, <span class="at">Mv=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27</code></pre>
<pre><code>## running glm to get initial regression estimate</code></pre>
<pre><code>## (Intercept)         age 
##  149.371801    6.521022</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="marginal_models.html#cb178-1" tabindex="-1"></a>oxboys.gee</span></code></pre></div>
<pre><code>## 
##  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA
##  gee S-function, version 4.13 modified 98/01/27 (1998) 
## 
## Model:
##  Link:                      Identity 
##  Variance to Mean Relation: Gaussian 
##  Correlation Structure:     AR-M , M = 1 
## 
## Call:
## gee(formula = height ~ age, id = Subject, data = Oxboys, corstr = &quot;AR-M&quot;, 
##     Mv = 1)
## 
## Number of observations :  234 
## 
## Maximum cluster size   :  9 
## 
## 
## Coefficients:
## (Intercept)         age 
##  149.719096    6.547328 
## 
## Estimated Scale Parameter:  65.41743
## Number of Iterations:  2
## 
## Working Correlation[1:4,1:4]
##           [,1]      [,2]      [,3]      [,4]
## [1,] 1.0000000 0.9892949 0.9787045 0.9682274
## [2,] 0.9892949 1.0000000 0.9892949 0.9787045
## [3,] 0.9787045 0.9892949 1.0000000 0.9892949
## [4,] 0.9682274 0.9787045 0.9892949 1.0000000
## 
## 
## Returned Error Value:
## [1] 0</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="marginal_models.html#cb180-1" tabindex="-1"></a><span class="co"># Compare to linear regression</span></span>
<span id="cb180-2"><a href="marginal_models.html#cb180-2" tabindex="-1"></a>oxboys.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(height<span class="sc">~</span>age, <span class="at">data=</span>Oxboys)</span>
<span id="cb180-3"><a href="marginal_models.html#cb180-3" tabindex="-1"></a>oxboys.lm</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = height ~ age, data = Oxboys)
## 
## Coefficients:
## (Intercept)          age  
##     149.372        6.521</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="marginal_models.html#cb182-1" tabindex="-1"></a><span class="fu">summary</span>(oxboys.gee)<span class="sc">$</span>coef</span></code></pre></div>
<pre><code>##               Estimate Naive S.E.  Naive z Robust S.E. Robust z
## (Intercept) 149.719096  1.5531285 96.39840   1.5847569 94.47449
## age           6.547328  0.3177873 20.60286   0.3042478 21.51972</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="marginal_models.html#cb184-1" tabindex="-1"></a><span class="fu">summary</span>(oxboys.lm)<span class="sc">$</span>coef</span></code></pre></div>
<pre><code>##               Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 149.371801  0.5285648 282.598864 1.987406e-296
## age           6.521022  0.8169867   7.981797  6.635134e-14</code></pre>
<p>Standard errors under the GEE can also <em>decrease</em>!</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-fahrmeir2001multivariate" class="csl-entry">
Fahrmeir, Ludwig, and Gerhard Tutz. 2001. <em>Multivariate Statistical Modelling Based on Generalized Linear Models (2nd Edition)</em>. Springer.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="quasi_likelihood.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear_mixed_models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/06-Marginal_models.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
